---
title: "TSQCA Reproducible Code (Japanese)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TSQCA Reproducible Code (Japanese)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

本ドキュメントは、TSQCA パッケージを用いた分析手順を  
**論文付録としてそのまま提示できること**を目的とした再現可能コード集です。
説明文は必要最小限とし、コードと設定値が明確になるように構成しています。

---

# 1. 使用パッケージ
```{r}
library(TSQCA)
library(QCA)
```

---

# 2. データ読み込み
```{r}
# データファイル名は適宜変更
library(TSQCA)
data("sample_data")
dat <- sample_data

# アウトカムと条件名
Yvar  <- "Y"
Xvars <- c("X1", "X2", "X3")

# 確認
str(dat)
summary(dat)
```

---

# 3. 閾値設定（ベースライン）
```{r}
# ベースラインとして用いる閾値
thrY_base  <- 7
thrX_base  <- 7

# X ごとの固定閾値（必要に応じて変更）
thrX_vec <- c(
  X1 = thrX_base,
  X2 = thrX_base,
  X3 = thrX_base
)
thrX_vec
```

---

# 4. CTS–QCA（ctSweepS）

単一条件 X（例：X3）の閾値をスイープする。
```{r, error=TRUE}
sweep_var   <- "X3"   # 閾値を変化させる対象の条件（X）
sweep_range <- 6:9    # 試す閾値候補
thrY         <- 7     # Y の閾値（固定）
thrX_default <- 7     # その他 X の閾値（固定）

res_cts <- ctSweepS(
  dat            = dat,
  Yvar           = "Y",
  Xvars          = c("X1", "X2", "X3"),
  sweep_var      = "X3",
  sweep_range    = 6:9,
  thrY           = 7,
  thrX_default   = 7,
  dir.exp        = 1,
  return_details = FALSE
)

head(res_cts)
```

必要に応じて、結果を CSV として保存：
```{r, eval=FALSE}
write.csv(res_cts, file = "TSQCA_CTS_results.csv", row.names = FALSE)
```

---

# 5. MCTS–QCA（ctSweepM）

複数条件 X の閾値を同時にスイープする。
```{r, error=TRUE}
res_mcts <- ctSweepM(
  dat            = dat,
  Yvar           = "Y",
  Xvars          = c("X1", "X2", "X3"),
  sweep_vars     = c("X2", "X3"),
  sweep_range    = 6:9,
  thrY           = 7,
  thrX_default   = 7,
  dir.exp        = 1,
  return_details = FALSE
)

head(res_mcts)
```
```{r, eval=FALSE}
write.csv(res_mcts, file = "TSQCA_MCTS_results.csv", row.names = FALSE)
```

---

# 6. OTS–QCA（otSweep）

アウトカム Y の閾値のみをスイープする。
```{r}
sweep_range_ots <- 6:9

res_ots <- otSweep(
  dat            = dat,
  Yvar           = "Y",
  Xvars          = c("X1", "X2", "X3"),
  sweep_range    = sweep_range_ots,
  thrX           = thrX_vec,
  dir.exp        = 1,
  return_details = FALSE
)

res_ots
```
```{r, eval=FALSE}
write.csv(res_ots, file = "TSQCA_OTS_results.csv", row.names = FALSE)
```

---

# 7. DTS–QCA（dtSweep）

X 側と Y 側を同時にスイープする二次元スイープ。
```{r}
sweep_list_dts_X <- list(
  X1 = 6:8,
  X2 = 6:8,
  X3 = 6:8
)

sweep_range_dts_Y <- 6:8

res_dts <- dtSweep(
  dat            = dat,
  Yvar           = "Y",
  Xvars          = c("X1", "X2", "X3"),
  sweep_list_X   = sweep_list_dts_X,
  sweep_range_Y  = sweep_range_dts_Y,
  dir.exp        = 1,
  return_details = FALSE
)

res_dts
```
```{r, eval=FALSE}
write.csv(res_dts, file = "TSQCA_DTS_results.csv", row.names = FALSE)
```



## References

For more information on TS-QCA methodology, see:

- Ragin, C. C. (2008). *Redesigning Social Inquiry: Fuzzy Sets and Beyond*. University of Chicago Press. DOI: [10.7208/chicago/9780226702797.001.0001](https://doi.org/10.7208/chicago/9780226702797.001.0001)
- Duşa, A. (2019). *QCA with R: A Comprehensive Resource*. Springer. DOI: [10.1007/978-3-319-75668-4](https://doi.org/10.1007/978-3-319-75668-4)
- Oana, I.-E., & Schneider, C. Q. (2024). A Robustness Test Protocol for Applied QCA: Theory and R Software Application. *Sociological Methods & Research*, 53(1), 57–88. DOI: [10.1177/00491241211036158](https://doi.org/10.1177/00491241211036158)


# 8. セッション情報
```{r}
sessionInfo()
```
